<% include header-base %>
<% include header-navbar %>

<% function formatAMPM (date) { %>
<%   var hours = date.getHours(); %>
<%   var minutes = date.getMinutes(); %>
<%   var ampm = hours >= 12 ? 'PM' : 'AM'; %>
<%   hours = hours % 12; %>
<%   hours = hours ? hours : 12; %>
<%   minutes = minutes < 10 ? '0'+minutes : minutes; %>
<%   var strTime = hours + ':' + minutes + ' ' + ampm; %>
<%   return strTime; %>
<% } %>

<div class="contents">

	<div class="sort-opts">
		<div class="toggle selected" id="current_tag" onclick="showCurrent()">
			Current Clients
		</div>
		<div class="toggle" id="archive_tag" onclick="showArchive()">
			Archived
		</div>
	</div>

	<div class="newclient"> 
		<i class="fa fa-user-plus"></i> 
		New Client 
	</div>

	<div class="title">
		Client List
	</div>

	<table class="cl-list">

		<tr class="current">
			<th>Client</th>
			<th>Conversation</th>
			<th>Last Activity</th>
			<th>Archive</th>
		</tr>

		<tr class="archive">
			<th>Client</th>
			<th>Last Conversation</th>
			<th>Last Activity</th>
			<th>Restore</th>
		</tr>


		<% if (clients.length > 0) { %>
			<% for (var i = 0; i < clients.length; i++ ) { %>

				<tr class="<%= clients[i].active ? 'current' : 'archive' %> <%= clients[i].active && !clients[i].open ? 'nonew' : '' %>">

					<td>
						<a href="/cms/<%= cm.cmid %>/cls/<%= clients[i].clid %>">
							<i class="fa fa-user"></i>
							<%=  clients[i].last %>, <%= clients[i].first %> <%= clients[i].middle %>
						</a>
					</td>

					<td>
						<% if (clients[i].clid !== null && clients[i].active) { %>
							<a href="/cms/<%= cm.cmid %>/cls/<%= clients[i].clid %>/convos/<%= clients[i].convid %>">
						<% } else { %>
							<a href="/cms/<%= cm.cmid %>/cls/<%= clients[i].clid %>">
						<% } %>

							<% if (clients[i].active) { %>
								<% if (clients[i].open) { %>
									<span class="fa-stack fa-lg">
										<i class="fa fa-circle fa-stack-2x"></i>
										<i class="fa fa-comments fa-stack-1x fa-inverse"></i>
									</span>
								<% } else { %>
									<span class="fa-stack fa-lg">
										<i class="fa fa-comments fa-stack-1x"></i>
									</span>
								<% } %>
							<% } %>

							<% var subj = (clients[i].subject !== null && clients[i].subject.length) < 35 ? clients[i].subject : clients[i].subject.substr(0,35) + "..." %>
							<% if (!subj) { subj = "No conversations." } %>
							<%= subj %>

							<% if (clients[i].msg_ct > 0) { %>
								<span class="badge">
									<%= clients[i].msg_ct %> unread
								</span>
							<% } %>

						</a>
					</td>
					
					<td>
						<% if (clients[i].clid !== null && clients[i].active) { %>
							<a href="/cms/<%= cm.cmid %>/cls/<%= clients[i].clid %>/convos/<%= clients[i].convid %>">
						<% } else { %>
							<a href="/cms/<%= cm.cmid %>/cls/<%= clients[i].clid %>">
						<% } %>

							<% try { %>
								<% var d = new Date(clients[i].updated); %>
								<%= [d.getMonth()+1, d.getDate()].join("/") + " at " + formatAMPM(d) %>
							<% } catch (e) { %>
								Unknown
							<% } %>

						</a>
					</td>
					
					<td>
						<% if (clients[i].active) { %>
							<form method="post" action="/cms/<%= user.cmid %>/cls/<%= clients[i].clid %>/archive">
								<button type="submit"><i class="fa fa-archive"></i></button>
							</form>
						<% } else { %>
							<form method="post" action="/cms/<%= user.cmid %>/cls/<%= clients[i].clid %>/restore">
								<button type="submit"><i class="fa fa-undo"></i></button>
							</form>
						<% } %>
					</td>

				</tr>

			<% } %>
		<% } %>

	</table>




<br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br>

<div class="right-nav">
	<div class="nav-btn">
		<a href="/cms/<%= cm.cmid %>">
			<i class="fa fa-refresh"></i>
			Check for alerts
		</a>
	</div>

	<div class="nav-btn">
		<a href="/capture %>">
			<i class="fa fa-table"></i>
			Capture board
		</a>
	</div>
</div>

<div class="themeblock">
	<div class="themeblock-label">
		ClientsSS
	</div>
	<div class="themeblock-body">

		<% if (clients.length > 0) { %>
			<% for (var i = 0; i < clients.length; i++ ) { %>

				<div class="themeblock-row">
					<a href="/cms/<%= cm.cmid %>/cls/<%= clients[i].clid %>">
						<%=  clients[i].last + ", " + clients[i].first + " " + clients[i].middle %>
					</a>

					<% if (clients[i].msg_ct > 0) { %>
						<span class="badge">
							<%= clients[i].msg_ct %> new messages
						</span>
					<% } %>
				</div>

			<% } %>
		<% } else { %>
			You have no clients.
		<% } %>

	</div>
</div>



<div class="infoblock">
	<div class="infoblock-label">
		Create New Account
	</div>
	<div class="infoblock-body">

		<form method="post">

			<div class="infoblock-row">
				<div class="infoblock-id">
					first
				</div>
				<input type="hidden" name="cmid" value="<%= cm.cmid %>">
				<input class="infoblock-input" type="text" name="first" placeholder="e.g. Jane" required>
			</div>

			<div class="infoblock-row">
				<div class="infoblock-id">
					middle
				</div>
				<input class="infoblock-input" type="text" name="middle" placeholder="e.g. M">
			</div>

			<div class="infoblock-row">
				<div class="infoblock-id">
					last
				</div>
				<input class="infoblock-input" type="text" name="last" placeholder="e.g. Doe" required>
			</div>

			<div class="infoblock-row">
				<div class="infoblock-id">
					dob
				</div>
				<input class="infoblock-input" type="date" name="dob" value="1955-01-01" required>
			</div>

			<div class="infoblock-row">
				<div class="infoblock-id">
					otn
				</div>
				<input class="infoblock-input" type="text" name="otn" placeholder="135792468">
			</div>

			<div class="infoblock-row">
				<div class="infoblock-id">
					so
				</div>
				<input class="infoblock-input" type="text" name="so" placeholder="246813579">
			</div>

				<input type="submit" class="button" value="Submit">

			
		</form>

	</div>
</div>

</div>




<script type="text/javascript">
	function showCurrent () {
		$("#current_tag").addClass("selected");
		$("#archive_tag").removeClass("selected");
		$(".archive").hide();
		$(".current").show();
	};
	function showArchive () {
		$("#current_tag").removeClass("selected");
		$("#archive_tag").addClass("selected");
		$(".archive").show();
		$(".current").hide();
	};
	showCurrent();
</script>
<% include footer %>
