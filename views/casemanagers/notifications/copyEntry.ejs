<% include ../../partials/headers/header-base %>

<!-- Include Card View specific styling -->
<link rel="stylesheet" type="text/css" href="/static/css/card.css">
<link rel="stylesheet" type="text/css" href="/static/css/cardInverse.css">

<div class="contents">

<!-- Moved the exit out of the card -->
<a href="/cms/<%= user.cmid %>/notifications">
  <% include ../../partials/card-exit %>
</a>

<div class="card">

  <div class="card-title">
    Start Notification
  </div>

  <form method="post">

    <input type="hidden" name="cmid" value="<%= user.cmid %>">

    <div class="form-row">
      <div class="form-label"> Date to send <small>(YYYY-MM-DD)</small></div>
      <input class="form-input" type="date" name="dob">
    </div>

    <div class="form-row">
      <div class="form-label"> Time to send </div>

      <!-- Options are for military hrs of day -->
      <select class="blue-select half" name="type">
        <option value="00"> 00 </option>
        <option value="01"> 01 </option>
        <option value="02"> 02 </option>
        <option value="03"> 03 </option>
        <option value="04"> 04 </option>
        <option value="05"> 05 </option>
        <option value="06"> 06 </option>
        <option value="07"> 07 </option>
        <option value="08" selected> 08 </option>
        <option value="09"> 09 </option>
        <option value="10"> 10 </option>
        <option value="11"> 11 </option>
        <option value="12"> 12 </option>
        <option value="13"> 13 </option>
        <option value="14"> 14 </option>
        <option value="15"> 15 </option>
        <option value="16"> 16 </option>
        <option value="17"> 17 </option>
        <option value="18"> 18 </option>
        <option value="19"> 19 </option>
        <option value="20"> 20 </option>
        <option value="21"> 21 </option>
        <option value="22"> 22 </option>
        <option value="23"> 23 </option>
        <option value="24"> 24 </option>
      </select>

      <select class="blue-select half" name="type">
        <option value="00" selected> :00 </option>
        <option value="30"> :30 </option>
      </select>

    </div>

    <div class="form-row">
      <div class="form-label"> Which client to notify  </div>
      <select class="blue-select" id="clientSelect" name="type">
        <option value="" disabled selected> Client </option>
        <% clients.forEach(function (client) { %>
          <option value="<%= client.id %>"> <%= client.name %> </option>
        <% }); %>
      </select>
    </div>

    <div class="form-row">
      <div class="form-label"> Which device to send to  </div>
      <select class="blue-select" id="commOptionsForClient" name="type">
        <option value="" disabled selected> Contact Info </option>
      </select>
    </div>

    <input type="submit" class="form-submit" value="Next">

  </form>

</div>
</div>

<script type="text/javascript">
  // Set global variable of all clients information
  window.clients = <%- JSON.stringify(clients) %>;

  // Bind clients to update of comm list
  $("#clientSelect").change(function () {
    // Get new client id value
    var v = $(this)[0].value;
    
    // Remove all existing children in options
    $("#commOptionsForClient").empty();

    // Now add all client comms associated with that client
    clients.forEach(function (client) {
      // Only add if client matches
      if (client.id == v) {
        client.comms.forEach(function (comm) {
          var newOpt =  '<option value="' + comm.id + '">' +
                        comm.name + " (" + comm.value + ")" +
                        '</option>';
          console.log(newOpt);
          $("#commOptionsForClient").append(newOpt);
        });
      }
    });
  });
</script>

<% include ../../partials/footers/footer %>
