<% include header %>

<div class="infoblock">
	<div class="infoblock-label">
		Organization
	</div>
	<div class="infoblock-body">
		<ul>
			<li>
				<b><%= org.name %></b>
			</li>

			<li>
				<div class="infoblock-id">
					email
				</div>
				<%= org.email %>
			</li>

			<li>
				<div class="infoblock-id">
					expires
				</div>
				<% try { %>
					<% var upd = new Date(org.expiration) %>
					<%= [upd.getMonth()+1, upd.getDate(), upd.getFullYear()].join("/") %>
				<% } catch (err) { %>
					Unknown
				<% } %>
			</li>

			<li>
				<div class="infoblock-id">
					allotment
				</div>
				<%= org.allotment %> users 
				<% try { %>
					(<%= Number(org.allotment) - Number(cms.length) %> remaining)
				<% } catch (err) { %>
					(error calculating remaining)
				<% } %>
			</li>

			<li>
				<div class="infoblock-id">
					created
				</div>
				<% try { %>
					<% var upd = new Date(org.created) %>
					<%= [upd.getMonth()+1, upd.getDate(), upd.getFullYear()].join("/") %>
				<% } catch (err) { %>
					Unknown
				<% } %>
			</li>

		</ul>
	</div>
</div>

<div class="infoblock">
	<div class="infoblock-label" onclick="toggle('adminaccounts')">
		Admin Accounts
	</div>
	<div class="infoblock-body">
		<ul>
			<li>
				<% var adminCt = 0; %>
				<% for (var i = 0; i < cms.length; i++) { if (cms[i].admin && cms[i].active) { adminCt += 1; }; } %>
				<i><%= adminCt %> active admins</i>
			</li>

			<span id="adminaccounts">
			<% for (var i = 0; i < cms.length; i++) { %>
				<% if (cms[i].admin && cms[i].active) { %>

					<li>
						<b>
						<a href="/cms/<%= cms[i].cmid %>">
							<%= cms[i].last %>, <%= cms[i].first %> <%= cms[i].middle %>
						</a>
						</b>
					</li>
					<li>
						<div class="infoblock-id">
							email
						</div>
						<%= cms[i].email %>
					</li>
					<li>
						<div class="infoblock-id">
							probation
						</div>
						<%= cms[i].position %>
					</li>
					<li>
						<div class="infoblock-id">
							department
						</div>
						<%= cms[i].department %>
					</li>
					<li>
						<div class="infoblock-id">
							created
						</div>
						<% try { %>
							<% var upd = new Date(cms[i].created) %>
							<%= [upd.getMonth()+1, upd.getDate(), upd.getFullYear()].join("/") %>
						<% } catch (err) { %>
							Unknown
						<% } %>
					</li>

				<% } %>
			<% } %>
			</span>

		</ul>
	</div>
</div>

<div class="infoblock">
	<div class="infoblock-label" onclick="toggle('staffaccounts')">
		Staff Accounts
	</div>
	<div class="infoblock-body">
		<ul>
			<li>
				<% var staffCt = 0; %>
				<% for (var i = 0; i < cms.length; i++) { if (!cms[i].admin && cms[i].active) { staffCt += 1; }; } %>
				<i><%= staffCt %> active staff</i>
			</li>

			<span id="staffaccounts">
			<% for (var i = 0; i < cms.length; i++) { %>
				<% if (!cms[i].admin && cms[i].active) { %>

					<li>
						<b>
						<a href="/cms/<%= cms[i].cmid %>">
							<%= cms[i].last %>, <%= cms[i].first %> <%= cms[i].middle %>
						</a>
						</b>
					</li>
					<li>
						<div class="infoblock-id">
							email
						</div>
						<%= cms[i].email %>
					</li>
					<li>
						<div class="infoblock-id">
							probation
						</div>
						<%= cms[i].position %>
					</li>
					<li>
						<div class="infoblock-id">
							department
						</div>
						<%= cms[i].department %>
					</li>
					<li>
						<div class="infoblock-id">
							created
						</div>
						<% try { %>
							<% var upd = new Date(cms[i].created) %>
							<%= [upd.getMonth()+1, upd.getDate(), upd.getFullYear()].join("/") %>
						<% } catch (err) { %>
							Unknown
						<% } %>
					</li>

				<% } %>
			<% } %>
			</span>

		</ul>
	</div>
</div>

<div class="infoblock">
	<div class="infoblock-label" onclick="toggle('newaccount')">
		Create New Account
	</div>
	<div class="infoblock-body" id="newaccount">

		<ul>
		<form method="post">
			
			<li>
				<input type="hidden" name="orgid" value="<%= org.orgid %>">	
				<i>Add user to organization</i>
			</li>

			<li>
				<div class="infoblock-id">
					first
				</div>
				<input type="text" name="first" placeholder="Jane" required>
			</li>

			<li>
				<div class="infoblock-id">
					middle
				</div>
				<input type="text" name="middle" placeholder="M">
			</li>

			<li>
				<div class="infoblock-id">
					last
				</div>
				<input type="text" name="last" placeholder="Doe" required>
			</li>

			<li>
				<div class="infoblock-id">
					email
				</div>
				<input type="email" name="email" placeholder="john@example.com" required>
			</li>

			<li>
				<div class="infoblock-id">
					password
				</div>
				<input type="password" name="password" placeholder="password" required>
			</li>

			<li>
				<div class="infoblock-id">
					position
				</div>
				<input type="text" name="position" placeholder="Case Manager" required>
			</li>

			<li>
				<div class="infoblock-id">
					department
				</div>
				<input type="text" name="department" placeholder="Pretrial Services" required>
			</li>

			<li>
				<div class="infoblock-id">
					admin
				</div>
				<input type="checkbox" name="admin" value="true"> check for admin privileges
			</li>

			<li>
				<input type="submit" class="button" value="Submit">
			</li>
			
		</form>
		</ul>

	</div>
</div>

<script type="text/javascript">
	function toggle (div) {
		$("#" + div).toggle();
	}
</script>	

<% include footer %>
