<% include header %>

<div class="right-nav">
	<div class="nav-btn">
		<a href="/cms/<%= cm.cmid %>">
			<i class="fa fa-reply"></i>
			Return To All Clients
		</a>
	</div>
	<div class="nav-btn">
		<a href="/cms/<%= cm.cmid %>">
			<i class="fa fa-pencil"></i>
			Edit Client Profile
		</a>
	</div>
</div>

<div class="infoblock">
	<div class="infoblock-label">
		Client
	</div>
	<div class="infoblock-body">
		<ul>

			<li>
				<i class="fa fa-user"></i>
				<b><%= client.last %>, <%= client.first %> <%= client.middle %></b>
			</li>

			<% if (client.otn) { %>
				<li>
					<div class="infoblock-id">
						otn
					</div>
					<%= client.otn %>
				</li>
			<% } %>

			<% if (client.so) { %>
				<li>
					<div class="infoblock-id">
						so
					</div>
					<%= client.so %>
				</li>
			<% } %>

		</ul>
	</div>
</div>

<div class="infoblock">
	<div class="infoblock-label">
		Conversations
	</div>
	<div class="infoblock-body">
		<ul>

			<li>
				<i class="fa fa-comments-o"></i>
				<i><%= convos.length %> Conversations</i>
			</li>

			<% if (convos.length > 0) { %>
					<% for (var i = 0; i < convos.length; i++) { %>

						<li>
							<a href="/cms/<%= cm.cmid %>/cls/<%= client.clid %>/convos/<%= convos[i].convid %>">
								<%= convos[i].subject %>
							</a>

							<i>
								<% try { %>
									<% var upd = new Date(convos[i].updated) %>
									<%= [upd.getHours(), upd.getMinutes(), upd.getSeconds()].join(':') %> 
									on
									<%= [upd.getMonth()+1, upd.getDate()].join("/") %>
								<% } catch (err) { %>
									Unknown
								<% } %>
							</i>

							<% if (convos[i].open) { %>
								<span class="badge">
									open
								</span>
							<% } %>
						</li>

					<% } %>
			<% } %>

		</ul>
	</div>
</div>


<div class="infoblock">
	<div class="infoblock-label" onclick="toggle('newconvo')">
		New Conversation
	</div>
	<div class="infoblock-body">
		<ul>
		<form method="post" action="/cms/<%= cm.cmid %>/cls/<%= client.clid %>/convos">

			<li>
				<i class="fa fa-plus-square-o"></i>
				<i>
					Create a new thread
				</i>
			</li>

			<span style="display:none" id="newconvo">
				<li>
					<div class="infoblock-id">
						subject
					</div>
					<input type="hidden" name="cmid" value="<%= cm.cmid %>">
					<input type="hidden" name="clid" value="<%= client.clid %>">
					<input type="text" name="subject" placeholder="e.g., Missed Appointment" required>
				</li>

				<li>
					<input type="submit" class="button" value="Submit">
					<br><i style="font-size:x-small">* closes other convos</i>
				</li>
			</span>

		</form>
		</ul>
	</div>
</div>


<br><br><br><br><br><br><br><br><br><br><br><br>




<% if (comms.length > 0) { %>
	<div>
		<b>Communication Devices associated with client:</b>
		<ul>
			<% for (var i = 0; i < comms.length; i++) { %>
				<li>
					<%= comms[i].name %>
					<ul style="font-size:small;">
						<li>
							<%= comms[i].type %>: 
							<%= comms[i].value %>
						</li>
					</ul>
				</li>
			<% } %>
		</ul>
	</div>
<% } %>

<hr>

<form method="post" action="/cms/<%= cm.cmid %>/cls/<%= client.clid %>/comm">

	<b>Add a new communication device</b>

	<input type="hidden" name="cmid" value="<%= cm.cmid %>">
	<input type="hidden" name="clid" value="<%= client.clid %>">

	<div class="form-row">
		<div class="form-desc">
			Communication Type
		</div>
		<div class="form-entry">
			<select name="type" required>
				<option value="" selected disabled>Comm Method</option>
				<option value="email" disabled>Email</option>
				<option value="cell">Cell</option>
				<option value="landline" disabled>Landline</option>
			</select>
		</div>
	</div>

	<div class="form-row">
		<div class="form-desc">
			Number
		</div>
		<div class="form-entry">
			<input type="text" name="value" placeholder="e.g. 1-858-487-2638" required>
		</div>
	</div>

	<div class="form-row">
		<div class="form-desc">
			Description
		</div>
		<div class="form-entry">
			<input type="text" name="description" placeholder="e.g. Aunt's Cell" required>
		</div>
	</div>

	<input type="submit" value="Submit">

</form>


<% include footer %>
