<% include ../../partials/cardFrameTop %>

<div class="cardHead">
  <!-- exit button -->
  <a href="/v4/users/<%=user.cmid%>/owner/departments">
    <% include ../../partials/cardExit %>
  </a>
  <div class="cardTitle">
    Select Supervisors
  </div>
  <div class="cardSubtitle">
    Use departments to organize your workforce.
  </div>
</div>

<div class="cardBody">

  <form method = "post"
        id="updateSupervisors"
        action = "/v4/users/<%=user.cmid%>/owner/departments/edit/<%=parameters.departmentID%>">

    <div class="scrollListBox">
      <% var supervisorIDs = supervisors.map(function (s) { return s.cmid }) %>
      <% members.forEach(function (member) { %>
        <div class="scrollListRow <% if (supervisorIDs.indexOf(member.cmid) > -1) { %>selected<% } %>" memberID="<%= member.cmid %>">

          <div class="scrollListContent">
            <div class="clientName">
              <%= member.last + ', ' + member.first %> <%= member.middle %>
            </div>
          </div>
        </div>
      <% }) %>
    </div>

    <input  type="submit" 
            class="formSubmit" 
            value="Save Department">
  </form>
</div>


<script type="text/javascript">
  $(".scrollListRow").click(function () {
    var selected = 0;
    $(".scrollListRow").each(function () {
      if ($(this).hasClass("selected")) {
        selected += 1;
      }
    });
    var currentlySelected = $(this).hasClass("selected");
    if (currentlySelected) selected += 1;
    console.log(selected, currentlySelected, $(this).attr("memberID"))
    if (selected !== 1 || (selected == 1 && !currentlySelected)) {
      $(this).toggleClass("selected");
    }
  });

  $("#updateSupervisors").submit(function () {
    $(".scrollListRow").each(function () {
      if ($(this).hasClass("selected")) {
        var clientID = $(this).attr("clientID");
        $(".scrollListBox").append("<input type='hidden' name='clientIDs' value='" + clientID + "'>");
      }
    });
    return true;
  });
</script>

<% include ../../partials/cardFrameBottom %>