<% include ../../partials/ownerFrameTop %>

<!-- Load in addition CSS -->
<link rel="stylesheet" type="text/css" href="/static/css/v4_ownerDashboard.css">

<div class="leftBar">
  <div class="departments">
    <div class="department">
      <div class="subject showAll">
        <a href="/v4/users/<%=user.cmid%>/owner/dashboard/overview">Show for all departments</a>
      </div>
    </div>
    <% departments.forEach(function (department) { %>
      <a href="/v4/users/<%=user.cmid%>/owner/dashboard/overview?departmentID=<%= department.department_id %>">
        <div class="department <% if (departmentFilterID == Number(department.department_id)) { %>selected<% } %>">
          <div class="subject">
            <%= department.name %>
          </div>
          <div class="date">
            <div class="day">Created on <%= moment.tz(department.updated, local_tz).format("DD/MM/YY") %></div>
          </div>
        </div>
      </a>
    <% }) %>
  </div>
</div>


<div class="rightContent">

  <div class="chart"><div id="overallGraph"></div></div>

</div>

<!-- Not bundled dependencies -->
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>

<script type="text/javascript">
  // On load actions
  try { adjustDivs(); } catch (e) { console.log(e); }
  $(window).resize(adjustDivs);

  function adjustDivs () {
    $(".leftBar").height($(window).height() - 92);
    $(".rightContent").height($(window).height() - 92);
  };

  var countsByWeek = <%- JSON.stringify(countsByWeek) %>;
  var countsByDay = <%- JSON.stringify(countsByDay) %>;
  buildPerformanceChart(countsByWeek, countsByDay);

  function buildPerformanceChart (countsByWeek, countsByDay) {
    var keysWeek = countsByWeek.map( function (count) { return count.time_period; });
    var keysDay  = countsByDay.map(  function (count) { return count.time_period; });
    var valsWeek = countsByWeek.map( function (count) { return Number(count.message_count); });
    var valsDay  = countsByDay.map(  function (count) { return Number(count.message_count); });

    c3.generate({
      data: {
        xs:{
            "Weekly Activity": "x1",
            "Daily Activity":  "x2"
        },
        columns: [
            ["x1"].concat(keysWeek),
            ["x2"].concat(keysDay),
            ["Weekly Activity"].concat(valsWeek),
            ["Daily Activity"].concat(valsDay)
        ],
        types: {"Weekly Activity": "area", "Daily Activity": "area"},
        colors: {
            "Weekly Activity": "#FFC966",
            "Daily Activity": "#FF6700"
        }
      },
      legend: { hide: true },
      axis: { x: { type: "timeseries", tick: { format: "%m/%d" } } },
      padding: { right: 0, top: 20 },
      size: { width: 750, height: 230 },
      grid: { y: { show: false }, x: { show: false } },
      bindto: "#overallGraph"
    });
  };


</script>

<% include ../../partials/hubFrameBottom %>